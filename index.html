<!DOCTYPE html><html lang="es"><head>
<meta charset="UTF-8"/><title></title><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="theme-color" content="#0f172a"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes">
<link rel="manifest" href="/manifest.json">
<link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
<link rel="apple-touch-icon" href="/icon-512.png">
<meta name="application-name" content="RADIZ">
<meta name="apple-mobile-web-app-title" content="RADIZ">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script src="https://checkout.wompi.co/widget.js" async></script>
<style>
*{box-sizing:border-box}html,body{height:100%;width:100%;overflow:hidden;overscroll-behavior:none;position:fixed;inset:0;touch-action:none}body{margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#0f172a;color:#111827}
#splash{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:#0f172a}
#splash .box{display:flex;flex-direction:column;align-items:center;gap:12px;padding:16px 18px;border-radius:18px;background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.14);backdrop-filter:blur(6px)}
#splash img{width:64px;height:64px;border-radius:18px;object-fit:contain}
#splash .spin{width:22px;height:22px;border-radius:999px;border:3px solid rgba(255,255,255,.25);border-top-color:#fff;animation:sp .85s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}#splash.hide{opacity:0;pointer-events:none;transition:opacity .18s ease-out}
.login-screen{position:relative;height:100dvh;min-height:100vh;width:100%;overflow:hidden;display:flex;align-items:center;justify-content:center;padding:24px 16px;background:#0f172a}
.login-bg{position:absolute;inset:0;background-image:url('radiz-driver.jpg.jpg');background-size:cover;background-position:center;transform:scale(1.02);filter:saturate(1.02) contrast(1.02)}
.login-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(15,23,42,.35) 0%,rgba(15,23,42,.65) 55%,rgba(15,23,42,.85) 100%)}
.login-content{position:relative;z-index:2;width:100%;max-width:460px;display:flex;flex-direction:column;align-items:center;text-align:center;gap:14px;padding:18px 14px 16px}
.login-logo{margin-top:-10px;margin-bottom:0;display:flex;justify-content:center}
.login-logo img{width:72px;height:72px;object-fit:contain;border-radius:18px;overflow:hidden}
.login-content .login-welcome{margin:-6px 0 0;font-size:1.55rem;line-height:1.15;font-weight:800;color:#fff;letter-spacing:.02em;text-shadow:0 10px 26px rgba(0,0,0,.35)}
.login-form{width:100%;display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:clamp(160px,28vh,320px)}
.login-input{width:min(310px,78vw);border:0!important;outline:0!important;-webkit-appearance:none;appearance:none;border-radius:14px;padding:12px 14px;font-size:1rem;color:#0f172a;box-shadow:0 18px 45px rgba(0,0,0,.22);background-clip:padding-box}
.login-input::placeholder{color:rgba(15,23,42,.6)}#loginId{background:rgba(37,99,235,.92);color:#fff}#loginId::placeholder{color:rgba(255,255,255,.8)}#loginPassword{background:rgba(249,115,22,.92);color:#fff}#loginPassword::placeholder{color:rgba(255,255,255,.85)}
.login-btn{width:min(310px,78vw);border:none;border-radius:16px;padding:12px 14px;font-size:1rem;font-weight:800;cursor:pointer;background:rgba(255,255,255,.88);color:#0f172a;box-shadow:0 18px 45px rgba(0,0,0,.25);transition:transform .1s,box-shadow .1s,background .1s}
.login-btn:hover{transform:translateY(-1px);background:#fff;box-shadow:0 22px 55px rgba(0,0,0,.28)}
.login-msg{width:min(310px,78vw);min-height:1.2em;font-size:.92rem;color:#fff;text-shadow:0 10px 26px rgba(0,0,0,.35);opacity:.95}.login-msg.error{color:#fecaca}.login-msg.ok{color:#bbf7d0}
.page{display:none;height:100dvh;min-height:100vh;overflow:hidden;align-items:flex-start;justify-content:center;padding:32px 16px}
.container{position:relative;width:100%;max-width:960px;background:#fff;border-radius:24px;box-shadow:0 18px 45px rgba(15,23,42,.14);padding:28px 32px 32px;overflow:visible}
.logo-top{text-align:center;margin-bottom:12px}.logo-top img{max-width:260px;max-height:120px;object-fit:contain}
.main-grid{display:grid;grid-template-columns:minmax(0,1.05fr) minmax(0,1.15fr);gap:24px;margin-top:8px}
.brand-card{position:relative;border-radius:22px;overflow:hidden;background:#0f172a;min-height:380px;box-shadow:0 18px 40px rgba(15,23,42,.32);color:#f9fafb}
.brand-image{position:absolute;inset:0}.brand-image img{width:100%;height:100%;object-fit:cover}
.brand-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(15,23,42,.15) 10%,rgba(15,23,42,.78) 80%)}
.brand-copy{position:absolute;left:18px;right:18px;bottom:18px}
.brand-kicker{margin:0 0 4px;font-size:.8rem;text-transform:uppercase;letter-spacing:.08em;color:#bfdbfe;font-weight:600}
.brand-copy h2{margin:0;font-size:1.45rem;line-height:1.25;font-weight:700}
.panel-main{display:flex;flex-direction:column}
.welcome-banner{display:flex;align-items:flex-start;gap:10px;background:#e0f2fe;border-radius:16px;padding:10px 14px;margin-bottom:18px;border:1px solid #bfdbfe}
.welcome-icon{position:relative;width:32px;height:32px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:#2563eb;color:transparent;flex-shrink:0}
.welcome-icon::before{content:"";position:absolute;width:3px;height:10px;border-radius:999px;background:#fff;top:11px;left:50%;transform:translateX(-50%)}
.welcome-icon::after{content:"";position:absolute;width:3px;height:3px;border-radius:999px;background:#fff;top:7px;left:50%;transform:translateX(-50%)}
.welcome-text-title{font-size:.95rem;font-weight:600;margin:0 0 2px;color:#0f172a}
.welcome-text-sub{margin:0;font-size:.85rem;color:#4b5563}
.portal-header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;margin-bottom:12px}
h1{margin:0 0 4px;font-size:1.9rem;letter-spacing:.03em}
.card{position:relative;border-radius:18px;border:1px solid #e5e7eb;padding:16px 18px;background:#fff;font-size:.9rem;transition:border-color .15s,box-shadow .15s,transform .1s,background .15s}
.card h2{margin:0 0 8px;font-size:1.05rem;font-weight:700;color:#111827}
.card p{margin:3px 0;color:#111827;font-size:.9rem}
.card p strong{font-weight:600}
.card:hover{border-color:#2563eb;box-shadow:0 16px 34px rgba(37,99,235,.18);background:#f9fbff;transform:translateY(-1px)}
.card-consulta,.card-pago{margin-bottom:18px}
.card-contrato::before,.card-pagos::before,.card-mantenimientos::before{content:"";position:absolute;top:18px;left:18px;width:26px;height:26px;background-size:contain;background-repeat:no-repeat;background-position:center}
.card-contrato::before{background-image:url('ícono_contrato1.svg')}
.card-pagos::before{background-image:url('ícono_pagos.svg')}
.card-mantenimientos::before{background-image:url('ícono_mantenimientos.svg')}
.card-contrato h2,.card-pagos h2,.card-mantenimientos h2{margin-left:40px}
.card-mantenimientos:hover{background:#fff7ed;border-color:#f97316;box-shadow:0 18px 38px rgba(249,115,22,.22)}
.section-title{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.section-title span{font-size:1.05rem;font-weight:700;color:#111827}
.section-icon{position:relative;width:28px;height:28px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:#eff6ff;flex-shrink:0}
.section-icon-search::before{content:"";position:absolute;width:13px;height:13px;border-radius:999px;border:2px solid #2563eb;top:6px;left:7px;box-sizing:border-box}
.section-icon-search::after{content:"";position:absolute;width:8px;height:2px;border-radius:999px;background:#2563eb;bottom:7px;right:6px;transform:rotate(45deg)}
.section-icon-money::before{content:"$";position:absolute;font-size:16px;font-weight:700;color:#2563eb}
label{font-size:.9rem;font-weight:600;color:#374151}
input[type="text"],input[type="number"],input[type="email"],input[type="date"],input[type="password"],textarea{width:100%;padding:10px 12px;border-radius:9px;border:1px solid #d1d5db;font-size:.95rem;outline:none;transition:border-color .15s,box-shadow .15s,background .15s;background:#f9fafb;font-family:inherit}
input[type="text"]:focus,input[type="number"]:focus,input[type="email"]:focus,input[type="date"]:focus,input[type="password"]:focus,textarea:focus{border-color:#2563eb;box-shadow:0 0 0 1px rgba(37,99,235,.18);background:#fff}
button{padding:11px 22px;border-radius:999px;border:none;font-size:.95rem;font-weight:600;cursor:pointer;background:#2563eb;color:#fff;display:inline-flex;align-items:center;justify-content:center;gap:6px;box-shadow:0 12px 26px rgba(37,99,235,.45);transition:transform .1s,box-shadow .1s,background .1s;white-space:nowrap}
button:hover{transform:translateY(-1px);background:#1d4ed8;box-shadow:0 16px 32px rgba(37,99,235,.55)}
button:disabled{opacity:.65;cursor:default;box-shadow:none;transform:none}
.btn-main{min-width:190px;justify-content:center}
.btn-afiliado{background:#f97316;box-shadow:0 12px 26px rgba(249,115,22,.45)}
.btn-afiliado:hover{background:#ea580c;box-shadow:0 16px 32px rgba(249,115,22,.6)}
.btn-app{padding:0;border:none;background:transparent;color:#1d4ed8;font-size:.9rem;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;box-shadow:none;white-space:nowrap;min-width:0}
.btn-app:hover{background:transparent;border:none;color:#1d4ed8;box-shadow:none;transform:none;text-decoration:underline}
.status{font-size:.9rem;margin-top:4px;min-height:1.2em}.status.error{color:#b91c1c}.status.ok{color:#065f46}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-top:6px;margin-bottom:18px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.75rem;font-weight:600;text-transform:uppercase}
.badge-activo{background:#dcfce7;color:#166534}.badge-inactivo{background:#fee2e2;color:#b91c1c}
footer{margin-top:10px;font-size:.75rem;color:#9ca3af;text-align:center}
#seccionPago h2{font-size:1.05rem;margin:0 0 4px;color:#111827}
#seccionPago p{font-size:.9rem;color:#4b5563;margin:4px 0 10px}
#seccionPago .row-pago{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.row-pago-botones{justify-content:space-between;margin-top:10px}
.btn-pago,.btn-qr{flex:1;min-width:0;background:#60a5fa;box-shadow:0 8px 18px rgba(96,165,250,.5)}
.btn-pago:hover,.btn-qr:hover{background:#3b82f6;box-shadow:0 10px 22px rgba(59,130,246,.6)}
#montoPago,#idContrato{width:220px}
#pagoError,#pagoContratoError{color:#dc2626;margin-top:6px;font-size:.85rem;display:none}#pagoContratoError{margin-top:4px}
.row-consulta{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:6px;margin-bottom:10px}
.affiliate-row{margin-top:18px;display:flex;justify-content:center}
.fab-menu{position:absolute;top:24px;right:24px;z-index:20;display:none}
.fab-btn{width:54px;height:54px;border-radius:999px;background:#2563eb;border:none;box-shadow:0 10px 24px rgba(37,99,235,.45);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .12s,box-shadow .12s,background .12s}
.fab-btn:hover{transform:translateY(-1px);background:#1d4ed8;box-shadow:0 14px 32px rgba(37,99,235,.55)}
.fab-btn span{display:block;width:22px;height:2px;border-radius:999px;background:#fff;position:relative}
.fab-btn span::before,.fab-btn span::after{content:"";position:absolute;left:0;width:22px;height:2px;border-radius:999px;background:#fff}
.fab-btn span::before{top:-6px}.fab-btn span::after{top:6px}
.menu-panel{position:absolute;top:86px;right:28px;background:#fff;border-radius:14px;box-shadow:0 12px 30px rgba(15,23,42,.22);padding:8px 0;width:260px;display:none;z-index:25}
.menu-title{font-size:.8rem;text-transform:uppercase;letter-spacing:.08em;font-weight:600;color:#6b7280;padding:6px 14px 4px}
.menu-item{padding:7px 14px;font-size:.9rem;cursor:pointer;color:#111827}
.menu-item:hover{background:#eff6ff;color:#1d4ed8}
.modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.45);display:none;align-items:center;justify-content:center;z-index:40;overflow:hidden}
.modal{background:#fff;border-radius:18px;max-width:480px;width:90%;padding:18px 20px;box-shadow:0 20px 45px rgba(15,23,42,.4);font-size:.9rem;max-height:calc(100dvh - 40px);overflow:hidden}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.modal-header h3{margin:0;font-size:1.05rem}
.modal-close{border:none;background:transparent;font-size:1.3rem;cursor:pointer;color:#6b7280;box-shadow:none;padding:0 6px}
.modal p{margin:4px 0;color:#111827}
.modal-actions{margin-top:14px;display:flex;justify-content:flex-end;gap:8px;flex-wrap:wrap}
.link-copy-row{display:flex;gap:8px;align-items:center;margin-top:4px}
.link-copy-row input{flex:1}
.copy-msg{font-size:.8rem;margin-top:6px;color:#6b7280}
.img-beneficios-renting{max-width:100%;height:auto;border-radius:12px;display:block;margin:4px auto}
.small-note{font-size:.78rem;color:#6b7280;margin-top:6px}
@media(max-width:900px){.main-grid{grid-template-columns:1fr}.brand-card{min-height:260px}}
@media(max-width:640px){.container{padding:22px 18px 24px;border-radius:18px}.portal-header{flex-direction:column;align-items:flex-start}.fab-menu{top:16px;right:16px}#montoPago,#idContrato{width:100%}}
</style></head><body>
<div id="splash" aria-label="Cargando"><div class="box"><img src="icon-512.png" alt="RADIZ"><div class="spin"></div></div></div>

<section class="login-screen">
  <div class="login-bg"></div><div class="login-overlay"></div>
  <div class="login-content">
    <div class="login-logo"><img src="icon-512.png" alt="RADIZ"></div>
    <h1 class="login-welcome">¡Buenas buenas!</h1>
    <form class="login-form" onsubmit="event.preventDefault();loginInversiones('login');">
      <input class="login-input" type="text" id="loginId" placeholder="Usuario (Ej: R4523)" autocomplete="username">
      <input class="login-input" type="password" id="loginPassword" placeholder="Contraseña" autocomplete="current-password">
      <button type="submit" class="login-btn">Entrar</button>
      <div id="loginMsg" class="login-msg"></div>
      <button type="button" class="btn-app" id="btnInstallLogin" onclick="manejarDescargaApp()">Descarga la App</button>
    </form>
  </div>
</section>

<div class="page">
  <div class="container">
    <div class="logo-top"><img src="logoradiz.png" alt="Logo RADIZ" id="logo-radiz"></div>

    <div class="fab-menu" id="fabMenu">
      <button class="fab-btn" type="button" onclick="toggleMenu()"><span></span></button>
      <div class="menu-panel" id="menuPanel">
        <div class="menu-title" id="menuTitle">Opciones</div>
        <div id="menuInicial">
          <div class="menu-item" onclick="abrirModal('modalInversiones')">Ir a inversiones</div>
          <div class="menu-item" id="menuDescargaApp" onclick="manejarDescargaApp()">Descarga la App</div>
        </div>
        <div id="menuRenting" style="display:none;">
          <div class="menu-item" onclick="abrirModal('modalBeneficios')">Beneficios</div>
          <div class="menu-item" onclick="solicitarGrua()">Solicitar grúa</div>
          <div class="menu-item" onclick="abrirModal('modalActualizarKm')">Actualizar kilometraje</div>
          <div class="menu-item">Señales</div>
          <div class="menu-item" onclick="abrirModal('modalHistorialPagos')">Historial de pagos</div>
          <div class="menu-item">Historial de mantenimientos</div>
          <div class="menu-item" onclick="abrirModal('modalSaldoFavor')">Mi saldo a favor</div>
          <div class="menu-item" onclick="abrirModal('modalAfiliado')">Link de referidos</div>
          <div class="menu-item" onclick="abrirModal('modalIncidente')">Notificar incidente</div>
          <div class="menu-item" onclick="abrirModal('modalTaller')">Taller asignado</div>
        </div>
        <div id="menuAfiliado" style="display:none;">
          <div class="menu-item">Beneficios</div>
          <div class="menu-item" onclick="abrirModal('modalHistorialPagos')">Historial de pagos</div>
          <div class="menu-item">Mapa vehicular</div>
          <div class="menu-item">Oportunidades</div>
          <div class="menu-item" onclick="abrirModal('modalMisContratosAfiliado')">Mis contratos</div>
          <div class="menu-item" onclick="abrirModal('modalActualizarDatosAfiliado')">Actualizar datos</div>
          <div class="menu-item" onclick="abrirModal('modalMiFlotaAfiliado')">Mi flota</div>
          <div class="menu-item" onclick="abrirModal('modalInvertirAfiliado')">Invertir</div>
        </div>
      </div>
    </div>

    <div class="main-grid">
      <div class="brand-card">
        <div class="brand-image"><img src="radiz-driver.jpg.jpg" alt="Conductor Radiz frente a vehículos de carga"></div>
        <div class="brand-overlay"></div>
        <div class="brand-copy"><p class="brand-kicker">Una marca de Proyecto I45 S.A.S.</p><h2>Vehículos que dignifican</h2></div>
      </div>

      <div class="panel-main">
        <div class="welcome-banner"><div class="welcome-icon"></div><div><p class="welcome-text-title">¡Bienvenido a Radiz Vehicular!</p><p class="welcome-text-sub">Consulte su contrato, realice pagos y descargue su historial.</p></div></div>
        <header class="portal-header"><div><h1></h1></div></header>

        <div class="card card-consulta">
          <div class="section-title"><div class="section-icon section-icon-search"></div><span>Consulta de contrato</span></div>
          <label for="idContrato">ID</label>
          <div class="row-consulta">
            <input type="text" id="idContrato" placeholder="Ejemplo: R4523">
            <button id="btnConsultar" class="btn-main" onclick="consultar()">Consultar</button>
          </div>
          <div id="status" class="status"></div>
        </div>

        <div class="card card-pago" id="seccionPago">
          <div class="section-title"><div class="section-icon section-icon-money"></div><span>Realizar pago</span></div>
          <p>Ingresa el monto a pagar y completa el proceso con Wompi.</p>
          <label for="montoPago">Monto a pagar (COP)</label>
          <div class="row-pago"><input id="montoPago" type="number" min="170000" step="1000" placeholder="Ej: 170000"></div>
          <div class="row-pago row-pago-botones">
            <button type="button" class="btn-main btn-pago" onclick="crearPagoWompi()">Pagar con Wompi</button>
            <button type="button" class="btn-main btn-qr" onclick="abrirModal('modalQR')">Ver QR</button>
          </div>
          <p id="pagoError">Ingresa un monto válido (mínimo 170.000).</p>
          <p id="pagoContratoError">Digita tu ID antes de pagar.</p>
        </div>

        <div class="affiliate-row"><button type="button" class="btn-app" onclick="abrirModal('modalInversiones')">Iniciar sesión</button></div>

        <div class="grid" id="resultados" style="display:none;">
          <div class="card card-contrato" id="cardContrato"></div>
          <div class="card card-pagos" id="cardPagos"></div>
          <div class="card card-mantenimientos" id="cardMantenimientos"></div>
        </div>

        <footer>Versión interna • RADIZ Suministro Vehicular</footer>
      </div>
    </div>
  </div>
</div>

<div class="modal-backdrop" id="modalBeneficios"><div class="modal"><div class="modal-header"><h3>Beneficios del plan</h3><button class="modal-close" type="button" onclick="cerrarModal('modalBeneficios')">&times;</button></div><p id="modalBeneficiosTexto">Información no disponible.</p></div></div>
<div class="modal-backdrop" id="modalHistorialPagos"><div class="modal">
  <div class="modal-header"><h3>Historial de pagos</h3><button class="modal-close" type="button" onclick="cerrarModal('modalHistorialPagos')">&times;</button></div>
  <p id="historialIntro" style="margin-bottom:6px;">Ingresa tu correo electrónico y el ID para solicitar tu historial en PDF.</p>
  <label for="correoHistorial">Correo electrónico</label><input type="email" id="correoHistorial" placeholder="ejemplo@correo.com">
  <label for="idHistorial">ID</label><input type="text" id="idHistorial" placeholder="Ej: R4523">
  <p id="historialMsg" style="font-size:.85rem;margin-top:6px;color:#6b7280;"></p>
  <div class="modal-actions">
    <button type="button" onclick="cerrarModal('modalHistorialPagos')">Cerrar</button>
    <button type="button" id="btnHistorialEnviar" onclick="enviarSolicitudHistorial()">Enviar</button>
    <button type="button" id="btnHistorialDescargar" style="display:none;" onclick="descargarHistorialPdf()">Descargar PDF</button>
  </div>
</div></div>
<div class="modal-backdrop" id="modalTaller"><div class="modal"><div class="modal-header"><h3>Taller asignado</h3><button class="modal-close" type="button" onclick="cerrarModal('modalTaller')">&times;</button></div><p id="modalTallerTexto">Información no disponible.</p></div></div>
<div class="modal-backdrop" id="modalActualizarKm"><div class="modal">
  <div class="modal-header"><h3>Actualizar kilometraje</h3><button class="modal-close" type="button" onclick="cerrarModal('modalActualizarKm')">&times;</button></div>
  <p>Ingresa el nuevo kilometraje y la placa del vehículo.</p>
  <label for="kmValor">Kilometraje actual</label><input type="number" id="kmValor" placeholder="Ej: 2500">
  <label for="kmIdVehiculo">Placa / ID vehículo</label><input type="text" id="kmIdVehiculo" placeholder="Ej: WRG02H">
  <p id="kmMsg" class="status"></p>
  <div class="modal-actions"><button type="button" onclick="cerrarModal('modalActualizarKm')">Cerrar</button><button type="button" onclick="enviarActualizacionKilometraje()">Enviar</button></div>
</div></div>
<div class="modal-backdrop" id="modalSaldoFavor"><div class="modal">
  <div class="modal-header"><h3>Mi saldo a favor</h3><button class="modal-close" type="button" onclick="cerrarModal('modalSaldoFavor')">&times;</button></div>
  <p>Tienes un saldo a favor por concepto de referidos: <strong>$0.00</strong>.</p>
  <div class="modal-actions"><button type="button" onclick="cerrarModal('modalSaldoFavor')">Cerrar</button></div>
</div></div>
<div class="modal-backdrop" id="modalQR"><div class="modal">
  <div class="modal-header"><h3>Pagar con código QR</h3><button class="modal-close" type="button" onclick="cerrarModal('modalQR')">&times;</button></div>
  <p>Escanea este código con la app de tu banco o billetera para realizar el pago:</p>
  <img src="QRRADIZ-38.png" alt="Código QR de pago RADIZ" style="max-width:100%;height:auto;border-radius:12px;display:block;margin:8px auto;">
  <p style="font-size:.8rem;color:#6b7280;margin-top:4px;">Recuerda incluir tu ID de contrato en la referencia del pago.</p>
  <div class="modal-actions"><button type="button" onclick="cerrarModal('modalQR')">Cerrar</button></div>
</div></div>
<div class="modal-backdrop" id="modalIncidente"><div class="modal">
  <div class="modal-header"><h3>Notificar incidente</h3><button class="modal-close" type="button" onclick="cerrarModal('modalIncidente')">&times;</button></div>
  <p>Cuéntanos qué sucedió con el vehículo.</p>
  <label for="incidenteDescripcion">Descripción del incidente</label>
  <textarea id="incidenteDescripcion" rows="4"></textarea>
  <label for="incidenteIdVehiculo">Placa / ID vehículo</label><input type="text" id="incidenteIdVehiculo" placeholder="Ej: WRC01H">
  <label for="incidenteFecha">Fecha del incidente</label><input type="date" id="incidenteFecha">
  <label for="incidenteFotos">Evidencia fotográfica (máx. 3)</label>
  <input type="file" id="incidenteFotos" accept="image/*" multiple>
  <div id="incidenteFotosHint" class="small-note">Puedes seleccionar hasta 3 imágenes.</div>
  <p id="incidenteMsg" class="status"></p>
  <div class="modal-actions"><button type="button" onclick="cerrarModal('modalIncidente')">Cerrar</button><button type="button" id="btnIncidenteEnviar" onclick="enviarIncidente()">Enviar</button></div>
</div></div>
<div class="modal-backdrop" id="modalInversiones"><div class="modal">
  <div class="modal-header"><h3>Iniciar sesión</h3><button class="modal-close" type="button" onclick="cerrarModal('modalInversiones')">&times;</button></div>
  <p>Ingrese su ID y contraseña para acceder a su portal.</p>
  <label for="invId">ID</label><input type="text" id="invId" placeholder="Ej: R4523">
  <label for="invPassword">Contraseña</label><input type="password" id="invPassword" placeholder="Tu contraseña">
  <p id="invLoginMsg" class="status"></p>
  <div class="modal-actions"><button type="button" onclick="cerrarModal('modalInversiones')">Cerrar</button><button type="button" onclick="loginInversiones()">Entrar</button></div>
  <p style="font-size:.8rem;margin-top:8px;color:#6b7280;">¿Olvidó su contraseña? Escríbanos a <a href="mailto:notificacionespi45@gmail.com">notificacionespi45@gmail.com</a> con el asunto "Reasignar contraseña".</p>
</div></div>

<div class="modal-backdrop" id="modalFechaPagosAfiliado"><div class="modal"><div class="modal-header"><h3>Fecha de pagos al afiliado</h3><button class="modal-close" type="button" onclick="cerrarModal('modalFechaPagosAfiliado')">&times;</button></div><p id="modalFechaPagosTexto">Dato no disponible.</p></div></div>
<div class="modal-backdrop" id="modalVehiculosAfiliado"><div class="modal"><div class="modal-header"><h3>Cantidad de vehículos afiliados</h3><button class="modal-close" type="button" onclick="cerrarModal('modalVehiculosAfiliado')">&times;</button></div><p id="modalVehiculosTexto">Número de vehículos: Dato no disponible.</p></div></div>
<div class="modal-backdrop" id="modalLiquidacionesAfiliado"><div class="modal"><div class="modal-header"><h3>Resumen de liquidaciones</h3><button class="modal-close" type="button" onclick="cerrarModal('modalLiquidacionesAfiliado')">&times;</button></div><p id="modalLiquidacionesTexto1">Número de liquidaciones: Dato no disponible.</p><p id="modalLiquidacionesTexto2">Valor total liquidado: Dato no disponible.</p></div></div>

<div class="modal-backdrop" id="modalMisContratosAfiliado"><div class="modal">
  <div class="modal-header"><h3>Mis contratos</h3><button class="modal-close" type="button" onclick="cerrarModal('modalMisContratosAfiliado')">&times;</button></div>
  <p>Solicita copia de tus contratos.</p>
  <label for="misContratosCorreo">Correo electrónico</label><input type="email" id="misContratosCorreo" placeholder="ejemplo@correo.com">
  <label for="misContratosId">ID</label><input type="text" id="misContratosId" placeholder="Ej: A0016">
  <p id="misContratosMsg" class="status"></p>
  <div class="modal-actions"><button type="button" onclick="cerrarModal('modalMisContratosAfiliado')">Cerrar</button><button type="button" onclick="enviarSolicitudMisContratos()">Solicitar</button></div>
</div></div>

<div class="modal-backdrop" id="modalActualizarDatosAfiliado"><div class="modal">
  <div class="modal-header"><h3>Actualizar datos</h3><button class="modal-close" type="button" onclick="cerrarModal('modalActualizarDatosAfiliado')">&times;</button></div>
  <p>Actualiza tus datos de pago y contacto.</p>
  <label for="actualizarCuenta">Cuenta bancaria</label><input type="text" id="actualizarCuenta" placeholder="Ej: 1234567890">
  <label for="actualizarCertificado">Certificado bancario (adjúntalo al responder el correo de confirmación)</label><input type="file" id="actualizarCertificado">
  <label for="actualizarCorreo">Correo electrónico</label><input type="email" id="actualizarCorreo" placeholder="ejemplo@correo.com">
  <label for="actualizarCelular">Número de celular</label><input type="text" id="actualizarCelular" placeholder="Ej: 3001234567">
  <label for="actualizarId">ID</label><input type="text" id="actualizarId" placeholder="Ej: A0016">
  <p id="actualizarDatosMsg" class="status"></p>
  <div class="modal-actions"><button type="button" onclick="cerrarModal('modalActualizarDatosAfiliado')">Cerrar</button><button type="button" onclick="enviarActualizacionDatosAfiliado()">Enviar</button></div>
</div></div>

<div class="modal-backdrop" id="modalMiFlotaAfiliado"><div class="modal"><div class="modal-header"><h3>Mi flota</h3><button class="modal-close" type="button" onclick="cerrarModal('modalMiFlotaAfiliado')">&times;</button></div><p id="miFlotaTexto">Información no disponible.</p></div></div>
<div class="modal-backdrop" id="modalInvertirAfiliado"><div class="modal"><div class="modal-header"><h3>Invertir</h3><button class="modal-close" type="button" onclick="cerrarModal('modalInvertirAfiliado')">&times;</button></div><p>Pronto podrás conocer nuevas oportunidades de inversión con Radiz.</p><img src="invertir_afiliado.png" alt="Oportunidades de inversión Radiz" style="max-width:100%;border-radius:12px;margin-top:8px;"></div></div>
<div class="modal-backdrop" id="modalAfiliado"><div class="modal">
  <div class="modal-header"><h3>Link de afiliado</h3><button class="modal-close" type="button" onclick="cerrarModal('modalAfiliado')">&times;</button></div>
  <p>Comparte nuestro link de referidos con tu ID (ejemplo: R4523) y gana hasta $70.000 pesos por cada referido aprobado.</p>
  <label for="linkAfiliadoInput">Link del formulario</label>
  <div class="link-copy-row"><input id="linkAfiliadoInput" type="text" readonly value="https://forms.gle/Lv1Rkp9qWQigUS4g8"><button type="button" onclick="copiarLinkAfiliado()">Copiar</button></div>
  <p id="linkAfiliadoMsg" class="copy-msg"></p>
</div></div>

<script>
const API_URL='https://script.google.com/macros/s/AKfycbxNiAZCMVvaagzFjYQgIsQkGEWJPui9baIHcO_-JjeJ6HvDYdDU5BdH8R6zzD3zDUw/exec';
const WOMPI_PUBLIC_KEY='pub_prod_D1w0Ys7mW5OJOueJoMi1rA5aLYJvlN06';
const WOMPI_INTEGRITY_KEY='prod_integrity_zNC4ZqryuKzC75Cp72boasFFTLgzmhKN';
const WOMPI_REDIRECT_URL='https://portal.radizco.com/';
const API_CALLBACK_URL=API_URL;

let tipoUsuarioActual=null,datosContratoActual=null,datosAfiliadoActual=null;
const RADIZ_USER_KEY='radiz_usuario_guardado';
const RADIZ_SES_ID='radiz_sesion_id';
const RADIZ_SES_TIPO='radiz_sesion_tipo';

let __modalOpenCount=0;
const __touchBlocker=(e)=>{e.preventDefault();};
const __wheelBlocker=(e)=>{if(e&&e.ctrlKey)return;e.preventDefault();};

const INC_MAX_FOTOS=3,INC_MAX_LADO=1280,INC_JPEG_Q=.75;
const el=(id)=>document.getElementById(id);

const SPLASH_MIN_MS=3000,SPLASH_MAX_MS=7000;
const __preloadImg=(src)=>new Promise(r=>{const i=new Image();i.onload=()=>r(true);i.onerror=()=>r(false);i.src=src;});
function __hideSplash(){const s=el('splash');if(!s)return;s.classList.add('hide');setTimeout(()=>{try{s.remove()}catch(e){}},260);}
function __initSplash(){const s=el('splash');if(!s)return;const min=new Promise(r=>setTimeout(r,SPLASH_MIN_MS));const img=__preloadImg('radiz-driver.jpg.jpg');const max=setTimeout(__hideSplash,SPLASH_MAX_MS);Promise.all([min,img]).then(()=>{clearTimeout(max);__hideSplash();});}

document.addEventListener('touchmove',__touchBlocker,{passive:false});
document.addEventListener('wheel',__wheelBlocker,{passive:false});

function __getSesionGuardada(){try{const id=(localStorage.getItem(RADIZ_SES_ID)||'').trim().toUpperCase();const tipo=(localStorage.getItem(RADIZ_SES_TIPO)||'').trim().toUpperCase();return {id,tipo};}catch(e){return {id:'',tipo:''};}}
function __autoEntrarSiHaySesion(){const s=__getSesionGuardada();if(!s.id||!s.tipo)return;if(s.tipo==='RENTING'){window.location.replace('/logistica/?id='+encodeURIComponent(s.id));return;}if(s.tipo==='AFILIADO'){window.location.replace('/inversiones/?id='+encodeURIComponent(s.id));return;}}

document.addEventListener('DOMContentLoaded',()=>{
  __autoEntrarSiHaySesion();
  const fab=el('fabMenu'),ini=el('menuInicial'),ren=el('menuRenting'),afi=el('menuAfiliado');
  if(fab) fab.style.display='block';
  if(ini) ini.style.display='block';
  if(ren) ren.style.display='none';
  if(afi) afi.style.display='none';
  try{const saved=localStorage.getItem(RADIZ_USER_KEY)||'';const i=el('loginId');if(i&&saved)i.value=saved;}catch(e){}
  const f=el('incidenteFotos');if(f) f.addEventListener('change',()=>{const h=el('incidenteFotosHint');if(!h)return;const n=(f.files&&f.files.length)?f.files.length:0;if(n>INC_MAX_FOTOS){h.textContent='Máximo '+INC_MAX_FOTOS+' imágenes. Ajusta tu selección.';}else if(n>0){h.textContent=n+' imagen(es) seleccionada(s).';}else{h.textContent='Puedes seleccionar hasta 3 imágenes.';}});
  __initSplash();
  __setTextoInstalacion();
});

function toggleMenu(){const p=el('menuPanel');if(p)p.style.display=(p.style.display==='block'?'none':'block');}

function __lockBody(){if(__modalOpenCount===0){document.body.classList.add('modal-lock');document.addEventListener('touchmove',__touchBlocker,{passive:false});document.addEventListener('wheel',__wheelBlocker,{passive:false});}__modalOpenCount++;}
function __unlockBody(){__modalOpenCount=Math.max(0,__modalOpenCount-1);if(__modalOpenCount===0){document.body.classList.remove('modal-lock');document.removeEventListener('touchmove',__touchBlocker,{passive:false});document.removeEventListener('wheel',__wheelBlocker,{passive:false});}}

function abrirModal(id){if(id==='modalHistorialPagos') prepararModalHistorial();const m=el(id);if(!m)return;__lockBody();m.style.display='flex';const menu=el('menuPanel');if(menu) menu.style.display='none';}
function cerrarModal(id){const m=el(id);if(!m)return;m.style.display='none';__unlockBody();}

/* ... (todas tus funciones existentes sin cambios) ... */
/* IMPORTANTE: desde aquí hacia abajo es tu mismo código existente; solo se reemplaza la lógica de instalación y el registro de SW. */

/* === PWA / INSTALACIÓN (NUEVO, CORRECTO) === */
let deferredInstallPrompt=null;
function esIOS(){return /iphone|ipad|ipod/i.test(navigator.userAgent||'');}
function esAndroid(){return /android/i.test(navigator.userAgent||'');}
function estaEnModoApp(){return (window.matchMedia&&window.matchMedia('(display-mode: standalone)').matches)||navigator.standalone===true;}
function __setInstallText(txt,disabled){
  const a=el('btnInstallLogin'),b=el('menuDescargaApp');
  if(a){a.textContent=txt;a.disabled=!!disabled;}
  if(b){b.textContent=txt;b.style.opacity=disabled?.75:1;}
}
function __setTextoInstalacion(){
  if(estaEnModoApp()){__setInstallText('App instalada',true);return;}
  if(esIOS()){__setInstallText('Instalar en iPhone',false);return;}
  if(deferredInstallPrompt){__setInstallText('Instalar app',false);return;}
  __setInstallText(esAndroid()?'Cómo instalar':'Descarga la App',false);
}
window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredInstallPrompt=e;
  __setTextoInstalacion();
});
window.addEventListener('appinstalled',()=>{
  deferredInstallPrompt=null;
  __setTextoInstalacion();
});
async function manejarDescargaApp(){
  if(estaEnModoApp()){alert('La app RADIZ ya está instalada en este dispositivo.');return;}
  if(esIOS()){
    alert('Para instalar RADIZ en iPhone/iPad:\n\n1. Abre en Safari.\n2. Toca "Compartir".\n3. "Añadir a pantalla de inicio".\n4. "Añadir".');
    return;
  }
  if(deferredInstallPrompt){
    try{
      deferredInstallPrompt.prompt();
      await deferredInstallPrompt.userChoice;
    }catch(e){}
    deferredInstallPrompt=null;
    __setTextoInstalacion();
    return;
  }
  if(esAndroid()){
    alert('Si no te aparece "Instalar app", revisa:\n\n1) Menú (⋮)\n2) "Instalar aplicación" o "Añadir a pantalla de inicio"\n\nSi aún no aparece, Chrome no está detectando la PWA (revisa manifest + sw.js).');
    return;
  }
  alert('Usa "Instalar aplicación" o "Añadir a pantalla de inicio" en el navegador.');
}

/* === SERVICE WORKER (debe existir /sw.js real en JS) === */
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>{navigator.serviceWorker.register('/sw.js',{scope:'/'}).then(()=>{}).catch(()=>{});});
}

/* === TU CÓDIGO EXISTENTE CONTINÚA AQUÍ (sin cambios) === */
/* (pega aquí exactamente el resto de tus funciones tal cual las tienes: consultar, wompi, incidentes, login, etc.) */
</script></body></html>
